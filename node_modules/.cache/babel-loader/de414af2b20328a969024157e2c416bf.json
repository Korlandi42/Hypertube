{"ast":null,"code":"import _defineProperty from \"/Users/korlandi/42/hypertube/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/Users/korlandi/42/hypertube/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/korlandi/42/hypertube/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/korlandi/42/hypertube/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/korlandi/42/hypertube/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/korlandi/42/hypertube/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/korlandi/42/hypertube/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/korlandi/42/hypertube/src/components/account/Informations.jsx\";\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { TextField, Button, Grid, Typography } from '@material-ui/core';\nimport { withStyles } from '@material-ui/core/styles';\nimport { req, validator, checkForm } from '../../utils';\nimport { alert } from '../../redux/snackbars/actions';\nimport host from '../../config';\n\nvar Informations =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Informations, _React$Component);\n\n  function Informations() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Informations);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Informations)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this._isMounted = false;\n\n    _this.setStateCheck = function (state, callback) {\n      if (_this._isMounted === true) {\n        _this.setState(state, function () {\n          if (callback) callback();\n        });\n      }\n    };\n\n    _this.state = {\n      form: {\n        username: '',\n        firstname: '',\n        lastname: '',\n        email: ''\n      },\n      formErrors: {\n        username: [],\n        firstname: [],\n        lastname: [],\n        email: []\n      }\n    };\n\n    _this.handleSubmit = function (e) {\n      e.preventDefault();\n      var _this$props = _this.props,\n          dispatch = _this$props.dispatch,\n          auth = _this$props.auth;\n\n      var body = _objectSpread({}, _this.state.form);\n\n      checkForm(body, _this.validate, function (errors, nbErrors) {\n        _this.setStateCheck(_objectSpread({}, _this.state, {\n          formErros: errors\n        }));\n\n        if (!nbErrors) {\n          req(host + '/api/users/' + auth.user.id, {\n            method: 'put',\n            body: body,\n            useToken: true\n          }).then(function (res) {\n            dispatch(alert('USER_EDIT_SUCCESS', 'success'));\n          }).catch(function (err) {\n            if (err._status === 400) {\n              if (err.violations[0].propertyPath === 'username') {\n                dispatch(alert('REGISTER_USERNAME_TOOK', 'error'));\n              } else if (err.violations[0].propertyPath === 'email') {\n                dispatch(alert('REGISTER_EMAIL_TOOK', 'error'));\n              }\n            }\n          });\n\n          if (_this.state.file && _this.state.file.size <= 10000) {\n            var data = new FormData();\n            data.append('file', _this.state.file);\n            req(host + '/api/media_objects/avatar/create', {\n              method: 'post',\n              body: data,\n              useToken: true,\n              contentType: false\n            }).catch(function (err) {\n              if (err._status >= 400 && err._status < 500) {\n                dispatch(alert('REGISTER_BAD_PICTURE', 'error'));\n              }\n            });\n          }\n        }\n      });\n    };\n\n    _this.validate = function (name) {\n      validator.value = _this.state.form[name];\n      if (name === 'username') return validator.notNull().minLen(3).maxLen(20).errors;else if (name === 'firstname') return validator.notNull().isAlphabetic().maxLen(40).errors;else if (name === 'lastname') return validator.notNull().isAlphabetic().maxLen(40).errors;else if (name === 'email') return validator.isEmail().errors;\n    };\n\n    _this.onChange = function (e) {\n      var name = e.target.name;\n\n      _this.setStateCheck(_objectSpread({}, _this.state, {\n        form: _objectSpread({}, _this.state.form, _defineProperty({}, name, e.target.value))\n      }), function () {\n        _this.setStateCheck({\n          formErrors: _objectSpread({}, _this.state.formErrors, _defineProperty({}, name, _this.validate(name)))\n        });\n      });\n    };\n\n    _this.onFileChange = function (e) {\n      var file = e.target.files[0];\n\n      if (file) {\n        var reader = new FileReader();\n\n        reader.onload = function () {\n          _this.setState(_objectSpread({}, _this.state, {\n            image: reader.result\n          }), function () {\n            _this.setState(_objectSpread({}, _this.state, {\n              file: file\n            }));\n          });\n        };\n\n        reader.readAsDataURL(file);\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(Informations, [{\n    key: \"fetchUser\",\n    value: function fetchUser(id) {\n      var _this2 = this;\n\n      var dispatch = this.props.dispatch;\n      req(host + '/api/users/me', {\n        useToken: true\n      }).then(function (res) {\n        _this2.setStateCheck(_objectSpread({}, _this2.state, {\n          form: {\n            username: res.username,\n            firstname: res.firstname,\n            lastname: res.lastname,\n            email: res.email\n          }\n        }));\n      }).catch(function (err) {\n        if (err._status === 404) dispatch(alert('USER_NOT_FOUND', 'error'));\n      });\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      this._isMounted = true;\n      this.fetchUser();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var classes = this.props.classes;\n      var locale = this.props.locales.locale;\n      var formErrors = this.state.formErrors;\n      var _this$state$form = this.state.form,\n          lastname = _this$state$form.lastname,\n          firstname = _this$state$form.firstname,\n          username = _this$state$form.username,\n          email = _this$state$form.email;\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154\n        },\n        __self: this\n      }, React.createElement(Typography, {\n        color: \"primary\",\n        variant: \"h5\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155\n        },\n        __self: this\n      }, locale.navbar.my_account), React.createElement(\"form\", {\n        onSubmit: this.handleSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      }, React.createElement(Grid, {\n        container: true,\n        spacing: 16,\n        justify: \"center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }, React.createElement(Grid, {\n        item: true,\n        xs: 12,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        error: formErrors.username.length ? true : false,\n        helperText: locale.validator[formErrors.username[0]],\n        name: \"username\",\n        label: locale.global.username,\n        onChange: this.onChange,\n        margin: \"normal\",\n        value: username,\n        fullWidth: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      })), React.createElement(Grid, {\n        item: true,\n        xs: 12,\n        md: 6,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        error: formErrors.firstname.length ? true : false,\n        helperText: locale.validator[formErrors.firstname[0]],\n        name: \"firstname\",\n        label: locale.global.firstname,\n        onChange: this.onChange,\n        margin: \"normal\",\n        value: firstname,\n        fullWidth: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171\n        },\n        __self: this\n      })), React.createElement(Grid, {\n        item: true,\n        xs: 12,\n        md: 6,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        error: formErrors.lastname.length ? true : false,\n        helperText: locale.validator[formErrors.lastname[0]],\n        name: \"lastname\",\n        label: locale.global.lastname,\n        onChange: this.onChange,\n        margin: \"normal\",\n        value: lastname,\n        fullWidth: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      })), React.createElement(Grid, {\n        item: true,\n        xs: 12,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 194\n        },\n        __self: this\n      }, React.createElement(TextField, {\n        error: formErrors.email.length ? true : false,\n        helperText: locale.validator[formErrors.email[0]],\n        name: \"email\",\n        label: locale.global.email,\n        onChange: this.onChange,\n        margin: \"normal\",\n        value: email,\n        fullWidth: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195\n        },\n        __self: this\n      })), this.state.image && React.createElement(Grid, {\n        item: true,\n        xs: 12,\n        sm: 6,\n        md: 7,\n        lg: 6,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: classes.avatar,\n        style: {\n          backgroundImage: 'url(' + this.state.image + ')'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      })), React.createElement(Grid, {\n        item: true,\n        xs: 12,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 215\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        accept: \"image/*\",\n        id: \"contained-button-file\",\n        type: \"file\",\n        style: {\n          display: 'none'\n        },\n        onChange: this.onFileChange,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216\n        },\n        __self: this\n      }), React.createElement(\"label\", {\n        htmlFor: \"contained-button-file\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }, React.createElement(Button, {\n        color: \"primary\",\n        component: \"span\",\n        fullWidth: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      }, locale.register.upload)))), React.createElement(Button, {\n        type: \"submit\",\n        variant: \"outlined\",\n        color: \"primary\",\n        className: classes.button,\n        fullWidth: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, locale.account.btn)));\n    }\n  }]);\n\n  return Informations;\n}(React.Component);\n\nvar styles = {\n  button: {\n    marginTop: '10px'\n  },\n  avatar: {\n    width: '100%',\n    paddingBottom: '100%',\n    backgroundColor: '#222',\n    backgroundPosition: 'center',\n    backgroundRepeat: 'no-repeat',\n    backgroundSize: '100% auto',\n    borderRadius: '5px'\n  }\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return state;\n};\n\nvar InformationsExport = Informations;\nInformationsExport = withStyles(styles)(InformationsExport);\nInformationsExport = connect(mapStateToProps)(InformationsExport);\nexport default InformationsExport;","map":{"version":3,"sources":["/Users/korlandi/42/hypertube/src/components/account/Informations.jsx"],"names":["React","connect","TextField","Button","Grid","Typography","withStyles","req","validator","checkForm","alert","host","Informations","_isMounted","setStateCheck","state","callback","setState","form","username","firstname","lastname","email","formErrors","handleSubmit","e","preventDefault","props","dispatch","auth","body","validate","errors","nbErrors","formErros","user","id","method","useToken","then","res","catch","err","_status","violations","propertyPath","file","size","data","FormData","append","contentType","name","value","notNull","minLen","maxLen","isAlphabetic","isEmail","onChange","target","onFileChange","files","reader","FileReader","onload","image","result","readAsDataURL","fetchUser","classes","locale","locales","navbar","my_account","length","global","avatar","backgroundImage","display","register","upload","button","account","btn","Component","styles","marginTop","width","paddingBottom","backgroundColor","backgroundPosition","backgroundRepeat","backgroundSize","borderRadius","mapStateToProps","InformationsExport"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { connect } from 'react-redux'\nimport { TextField, Button, Grid, Typography } from '@material-ui/core'\nimport { withStyles } from '@material-ui/core/styles'\nimport { req, validator, checkForm } from '../../utils'\nimport { alert } from '../../redux/snackbars/actions'\nimport host from '../../config'\n\nclass Informations extends React.Component {\n\n  _isMounted = false\n  setStateCheck = (state, callback) => {\n    if (this._isMounted === true) {\n      this.setState(state, () => {\n        if (callback) callback()\n      })\n    }\n  }\n\n  state = {\n    form: {\n      username: '',\n      firstname: '',\n      lastname: '',\n      email: '',\n    },\n    formErrors: {\n      username: [], firstname: [], lastname: [], email: []\n    }\n  }\n\n  fetchUser(id) {\n    const { dispatch } = this.props\n    req(host + '/api/users/me', {useToken: true})\n    .then(res => {\n      this.setStateCheck({\n        ...this.state,\n        form : {\n          username: res.username,\n          firstname: res.firstname,\n          lastname: res.lastname,\n          email: res.email,\n        }\n      })\n    }).catch(err => {\n      if (err._status === 404)\n        dispatch(alert('USER_NOT_FOUND', 'error'))\n    })\n  }\n\n  handleSubmit = (e) => {\n    e.preventDefault()\n    const { dispatch, auth } = this.props\n    const body = {...this.state.form}\n\n    checkForm(body, this.validate, (errors, nbErrors) => {\n      this.setStateCheck({...this.state, formErros: errors})\n      if (!nbErrors) {\n        req(host + '/api/users/' + auth.user.id, {\n          method: 'put',\n          body: body,\n          useToken: true,\n        })\n        .then(res => {\n          dispatch(alert('USER_EDIT_SUCCESS', 'success'))\n        })\n        .catch(err => {\n          if (err._status === 400) {\n            if (err.violations[0].propertyPath === 'username') {\n              dispatch(alert('REGISTER_USERNAME_TOOK', 'error'))\n            } else if (err.violations[0].propertyPath === 'email') {\n              dispatch(alert('REGISTER_EMAIL_TOOK', 'error'))\n            }\n          }\n        })\n        if (this.state.file && this.state.file.size <= 10000) {\n          const data = new FormData();\n          data.append('file', this.state.file)\n          req(host + '/api/media_objects/avatar/create', {\n            method: 'post',\n            body: data,\n            useToken: true,\n            contentType: false\n          }).catch(err => {\n            if (err._status >= 400 && err._status < 500) {\n              dispatch(alert('REGISTER_BAD_PICTURE', 'error'))\n            }\n          })\n        }\n      }\n    })\n  }\n\n  validate = (name) => {\n    validator.value = this.state.form[name]\n\n    if (name === 'username')\n      return validator.notNull().minLen(3).maxLen(20).errors\n    else if (name === 'firstname')\n      return validator.notNull().isAlphabetic().maxLen(40).errors\n    else if (name === 'lastname')\n      return validator.notNull().isAlphabetic().maxLen(40).errors\n    else if (name === 'email')\n      return validator.isEmail().errors\n  }\n\n  onChange = (e) => {\n    let name = e.target.name\n    this.setStateCheck({\n      ...this.state,\n      form: {\n        ...this.state.form,\n        [name]: e.target.value\n      }\n    }, () => {\n      this.setStateCheck({\n        formErrors: {\n          ...this.state.formErrors,\n          [name]: this.validate(name)\n        }\n      })\n    })\n  }\n\n  onFileChange = (e) => {\n    const file = e.target.files[0]\n    if (file) {\n      let reader = new FileReader()\n      reader.onload = () => {\n        this.setState({...this.state, image: reader.result}, () => {\n          this.setState({...this.state, file: file})\n        })\n      }\n      reader.readAsDataURL(file)\n    }\n  }\n\n  componentWillMount() {\n    this._isMounted = true\n    this.fetchUser()\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false\n  }\n\n  render () {\n    const { classes } = this.props\n    const { locale } = this.props.locales\n    const { formErrors } = this.state\n    const { lastname, firstname, username, email } = this.state.form\n\n    return (\n      <div>\n        <Typography color=\"primary\" variant=\"h5\">{locale.navbar.my_account }</Typography>\n        <form onSubmit={this.handleSubmit}>\n          <Grid container spacing={16} justify=\"center\">\n            <Grid item xs={12}>\n              <TextField\n                error={formErrors.username.length ? true : false}\n                helperText={locale.validator[formErrors.username[0]]}\n                name=\"username\"\n                label={locale.global.username}\n                onChange={this.onChange}\n                margin=\"normal\"\n                value={username}\n                fullWidth\n              />\n            </Grid>\n            <Grid item xs={12} md={6}>\n              <TextField\n                error={formErrors.firstname.length ? true : false}\n                helperText={locale.validator[formErrors.firstname[0]]}\n                name=\"firstname\"\n                label={locale.global.firstname}\n                onChange={this.onChange}\n                margin=\"normal\"\n                value={firstname}\n                fullWidth\n              />\n            </Grid>\n            <Grid item xs={12} md={6}>\n              <TextField\n                error={formErrors.lastname.length ? true : false}\n                helperText={locale.validator[formErrors.lastname[0]]}\n                name=\"lastname\"\n                label={locale.global.lastname}\n                onChange={this.onChange}\n                margin=\"normal\"\n                value={lastname}\n                fullWidth\n              />\n            </Grid>\n            <Grid item xs={12}>\n              <TextField\n                error={formErrors.email.length ? true : false}\n                helperText={locale.validator[formErrors.email[0]]}\n                name=\"email\"\n                label={locale.global.email}\n                onChange={this.onChange}\n                margin=\"normal\"\n                value={email}\n                fullWidth\n              />\n            </Grid>\n            {this.state.image &&\n              <Grid item xs={12} sm={6} md={7} lg={6}>\n                <div\n                  className={classes.avatar}\n                  style={{backgroundImage:'url(' + this.state.image + ')'}}\n                >\n                </div>\n              </Grid>\n            }\n            <Grid item xs={12}>\n              <input accept=\"image/*\" id=\"contained-button-file\" type=\"file\" style={{display: 'none'}} onChange={this.onFileChange}/>\n              <label htmlFor=\"contained-button-file\">\n                <Button color=\"primary\" component=\"span\" fullWidth>\n                  {locale.register.upload}\n                </Button>\n              </label>\n            </Grid>\n          </Grid>\n          <Button\n            type=\"submit\"\n            variant=\"outlined\"\n            color=\"primary\"\n            className={classes.button}\n            fullWidth\n          >\n            {locale.account.btn}\n          </Button>\n        </form>\n      </div>\n    )\n  }\n}\n\nconst styles = {\n  button: {\n    marginTop: '10px'\n  },\n  avatar: {\n    width: '100%',\n    paddingBottom: '100%',\n    backgroundColor: '#222',\n    backgroundPosition: 'center',\n    backgroundRepeat: 'no-repeat',\n    backgroundSize: '100% auto',\n    borderRadius: '5px'\n  }\n}\nconst mapStateToProps = (state) => {\n  return state\n}\n\nlet InformationsExport = Informations\nInformationsExport = withStyles(styles)(InformationsExport)\nInformationsExport = connect(mapStateToProps)(InformationsExport)\nexport default InformationsExport\n"]},"metadata":{},"sourceType":"module"}